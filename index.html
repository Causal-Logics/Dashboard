<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategic Analysis & Casualty Prediction Suite</title>
    <script crossorigin src="[https://unpkg.com/react@18/umd/react.production.min.js](https://unpkg.com/react@18/umd/react.production.min.js)"></script>
    <script crossorigin src="[https://unpkg.com/react-dom@18/umd/react-dom.production.min.js](https://unpkg.com/react-dom@18/umd/react-dom.production.min.js)"></script>
    <script src="[https://cdn.plot.ly/plotly-2.27.0.min.js](https://cdn.plot.ly/plotly-2.27.0.min.js)"></script>
    <script src="[https://unpkg.com/@babel/standalone/babel.min.js](https://unpkg.com/@babel/standalone/babel.min.js)"></script>
    <script src="[https://cdn.tailwindcss.com](https://cdn.tailwindcss.com)"></script>
    <link href="[https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&display=swap](https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&display=swap)" rel="stylesheet">

    <style>
        body { font-family: 'JetBrains Mono', monospace; background-color: #020617; color: #f8fafc; margin: 0; }
        .tab-btn.active { border-bottom: 3px solid #10b981; color: #10b981; }
        .axiom-card { background: #0f172a; border: 1px solid #334155; transition: all 0.3s; }
        .axiom-card:hover { border-color: #10b981; transform: translateY(-2px); }
        .axiom-card.new-segment { 
            animation: slideIn 0.4s ease-out, highlight 2s ease-out;
            border-color: #3b82f6;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes highlight {
            0% { background-color: #1e3a8a; }
            100% { background-color: #0f172a; }
        }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, createElement: h } = React;

        // --- SHARED DATA ---
        const CAUSAL_AXIOMS = {
            Structural: { keywords: ["resource", "constraint", "budget", "funding", "material", "physical"] },
            Institutional: { keywords: ["law", "policy", "regulation", "mandate", "court", "authority"] },
            Ideational: { keywords: ["culture", "identity", "belief", "value", "tradition", "symbol"] },
            Psychological: { keywords: ["fear", "anger", "emotion", "bias", "instinct", "trauma"] }
        };

        // --- COMPONENTS ---
        function App() {
            const [activeTab, setActiveTab] = useState('research');
            const [analysisHistory, setAnalysisHistory] = useState([]);
            const [selectedActorProfile, setSelectedActorProfile] = useState(null);

            const bridgeToSimulation = (actorName, scores, aggregatedData = null, casualtyData = null) => {
                setSelectedActorProfile({
                    name: actorName,
                    structural: scores.Structural > 0,
                    institutional: scores.Institutional > 0,
                    ideational: scores.Ideational > 0,
                    psychological: scores.Psychological > 0,
                    positional: Math.random() > 0.5,
                    aggregatedScores: aggregatedData ? aggregatedData : scores,
                    isAggregated: aggregatedData !== null,
                    casualtyData: casualtyData
                });
                setActiveTab('simulation');
            };

            const sendAllToSimulator = (segments) => {
                if (segments.length === 0) return;
                const aggregated = { Structural: 0, Institutional: 0, Ideational: 0, Psychological: 0 };
                const actorSet = new Set();
                const sourceSet = new Set();
                const casualtyReports = [];
                let trueCasualtyCount = null;

                segments.forEach(segment => {
                    Object.keys(aggregated).forEach(key => { aggregated[key] += segment.scores[key] || 0; });
                    actorSet.add(segment.actor);
                    sourceSet.add(segment.source);
                    if (segment.casualties !== undefined) casualtyReports.push(segment.casualties);
                    if (segment.trueCasualties !== undefined && trueCasualtyCount === null) trueCasualtyCount = segment.trueCasualties;
                });

                const casualtyData = {
                    average: parseFloat((casualtyReports.reduce((a, b) => a + b, 0) / casualtyReports.length).toFixed(1)),
                    min: Math.min(...casualtyReports),
                    max: Math.max(...casualtyReports),
                    true: trueCasualtyCount,
                    segments: segments.length
                };

                bridgeToSimulation(`Aggregated Analysis`, aggregated, aggregated, casualtyData);
            };

            return (
                <div className="min-h-screen flex flex-col">
                    <header className="bg-slate-900 border-b border-slate-800 p-6 flex justify-between items-center">
                        <div>
                            <h1 className="text-xl font-bold text-emerald-400">STRATEGIC ANALYSIS SUITE v2.0</h1>
                            <p className="text-xs text-slate-400">NLP Extraction + Markov Chain Prediction</p>
                        </div>
                        <nav className="flex gap-6">
                            <button onClick={() => setActiveTab('research')} className={`tab-btn pb-2 font-bold ${activeTab === 'research' ? 'active' : ''}`}>1. RESEARCH & NLP</button>
                            <button onClick={() => setActiveTab('simulation')} className={`tab-btn pb-2 font-bold ${activeTab === 'simulation' ? 'active' : ''}`}>2. DEATH PROBABILITY</button>
                        </nav>
                    </header>
                    <main className="flex-1 p-6">
                        {activeTab === 'research' ? 
                            <ResearchModule onActorExport={bridgeToSimulation} onSendAll={sendAllToSimulator} history={analysisHistory} setHistory={setAnalysisHistory} /> : 
                            <SimulationModule importedProfile={selectedActorProfile} />
                        }
                    </main>
                </div>
            );
        }

        function ResearchModule({ onActorExport, onSendAll, history, setHistory }) {
            const [loading, setLoading] = useState(false);
            const [incident, setIncident] = useState("Iran protests");
            const [actors, setActors] = useState("Government, protestors");
            const [progress, setProgress] = useState("");

            useEffect(() => {
                const timer = setTimeout(() => {
                    setHistory(prev => prev.map(item => ({ ...item, isNew: false })));
                }, 2000);
                return () => clearTimeout(timer);
            }, [history]);

            const handleSearch = async () => {
                setLoading(true);
                const actorArray = actors.split(',').map(a => a.trim());
                const trueCas = Math.floor(Math.random() * 20) + 1;
                
                for (let i = 0; i < 5; i++) {
                    setProgress(`Analyzing Source ${i+1}...`);
                    await new Promise(r => setTimeout(r, 600));
                    const newSegment = {
                        id: Date.now() + i,
                        timestamp: new Date().toLocaleTimeString(),
                        actor: actorArray[i % actorArray.length],
                        source: ["Reuters", "AP", "NYT", "Washington Post"][i % 4],
                        text: "Strategic framework analysis regarding " + incident,
                        scores: { Structural: 2, Institutional: 1, Ideational: 0, Psychological: 0 },
                        casualties: Math.max(0, trueCas + Math.floor(Math.random() * 5 - 2)),
                        trueCasualties: trueCas,
                        isNew: true
                    };
                    setHistory(prev => [newSegment, ...prev]);
                }
                setLoading(false);
                setProgress("");
            };

            return (
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <section className="bg-slate-900 p-6 rounded-xl border border-slate-800">
                        <h2 className="text-emerald-400 font-bold mb-4">üîç INCIDENT PARAMETERS</h2>
                        <div className="space-y-4">
                            <input value={incident} onChange={e => setIncident(e.target.value)} className="w-full bg-slate-800 border border-slate-700 p-3 rounded text-sm" placeholder="Incident..."/>
                            <input value={actors} onChange={e => setActors(e.target.value)} className="w-full bg-slate-800 border border-slate-700 p-3 rounded text-sm" placeholder="Actors..."/>
                            <button onClick={handleSearch} className="w-full bg-emerald-600 p-3 rounded font-bold">{loading ? "PROCESSING..." : "START RESEARCH"}</button>
                            {progress && <div className="text-blue-400 text-xs animate-pulse">{progress}</div>}
                        </div>
                    </section>
                    <section className="bg-slate-900 p-6 rounded-xl border border-slate-800">
                        <div className="flex justify-between mb-4">
                            <h2 className="text-emerald-400 font-bold">üìà ANALYZED SEGMENTS</h2>
                            <button onClick={() => onSendAll(history)} className="text-xs text-blue-400">SEND ALL TO SIMULATOR</button>
                        </div>
                        <div className="space-y-4 max-h-[500px] overflow-y-auto custom-scroll">
                            {history.map(item => (
                                <div key={item.id} className={`axiom-card p-4 rounded-lg ${item.isNew ? 'new-segment' : ''}`}>
                                    <div className="flex justify-between text-xs mb-2">
                                        <span className="text-blue-400 font-bold">{item.actor}</span>
                                        <span className="text-slate-500">{item.timestamp}</span>
                                    </div>
                                    <p className="text-xs italic text-slate-300 mb-2">"{item.text}"</p>
                                    <button onClick={() => onActorExport(item.actor, item.scores)} className="text-[10px] bg-emerald-900/50 text-emerald-400 p-1 rounded">SIMULATE actor</button>
                                </div>
                            ))}
                        </div>
                    </section>
                </div>
            );
        }

        function SimulationModule({ importedProfile }) {
            const [actorA, setActorA] = useState({ name: 'Actor A', behaviors: { structural: true, ideational: false, institutional: false, psychological: false, positional: false } });
            const [actorB, setActorB] = useState({ name: 'Actor
