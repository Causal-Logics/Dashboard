<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategic Analysis Suite v2.6 - Momentum & Causal Logic</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'JetBrains Mono', monospace; background-color: #020617; color: #f8fafc; margin: 0; }
        .tab-btn.active { border-bottom: 3px solid #10b981; color: #10b981; }
        .axiom-card { background: #0f172a; border: 1px solid #334155; transition: all 0.3s; }
        .axiom-card.new-segment { animation: slideIn 0.4s ease-out; border-color: #3b82f6; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, createElement: h } = React;

        function App() {
            const [activeTab, setActiveTab] = useState('research');
            const [history, setHistory] = useState([]);
            const [simData, setSimData] = useState(null);

            const handleBridge = (aggregatedResults) => {
                setSimData(aggregatedResults);
                setActiveTab('simulation');
            };

            return (
                <div className="min-h-screen flex flex-col">
                    <header className="bg-slate-900 border-b border-slate-800 p-6 flex justify-between items-center">
                        <div>
                            <h1 className="text-xl font-bold text-emerald-400 uppercase tracking-tighter">Strategic Analysis Suite v2.6</h1>
                            <p className="text-[10px] text-slate-500 font-bold">SENTIMENT MOMENTUM // TEMPORAL CAUSAL LOGIC</p>
                        </div>
                        <nav className="flex gap-6">
                            <button onClick={() => setActiveTab('research')} className={`tab-btn pb-2 font-bold text-xs ${activeTab === 'research' ? 'active' : 'text-slate-500'}`}>1. NLP INGESTION</button>
                            <button onClick={() => setActiveTab('simulation')} className={`tab-btn pb-2 font-bold text-xs ${activeTab === 'simulation' ? 'active' : 'text-slate-500'}`}>2. MOMENTUM SIM</button>
                        </nav>
                    </header>
                    <main className="flex-1 p-6">
                        {activeTab === 'research' ? 
                            <ResearchTab onBridge={handleBridge} history={history} setHistory={setHistory} /> : 
                            <SimulationTab inputData={simData} />
                        }
                    </main>
                </div>
            );
        }

        function ResearchTab({ onBridge, history, setHistory }) {
            const [loading, setLoading] = useState(false);
            const [actors, setActors] = useState("State Actor, Insurgent");

            const runNLP = async () => {
                setLoading(true);
                const actorArray = actors.split(',').map(a => a.trim());
                for (let i = 0; i < 8; i++) {
                    await new Promise(r => setTimeout(r, 150));
                    const newEntry = {
                        id: Date.now() + i,
                        timestamp: new Date(Date.now() - (8-i) * 86400000).toLocaleDateString(),
                        actor: actorArray[i % 2],
                        scores: { 
                            Structural: Math.floor(Math.random() * 5), 
                            Institutional: Math.floor(Math.random() * 5),
                            Ideational: Math.floor(Math.random() * 5),
                            Psychological: Math.floor(Math.random() * 5)
                        },
                        casualties: Math.floor(Math.random() * 12),
                        isNew: true
                    };
                    setHistory(prev => [newEntry, ...prev]);
                }
                setLoading(false);
            };

            return (
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div className="bg-slate-900 p-6 rounded-xl border border-slate-800">
                        <h2 className="text-emerald-400 font-bold text-xs mb-4">INGESTION</h2>
                        <input value={actors} onChange={e => setActors(e.target.value)} className="w-full bg-slate-800 border border-slate-700 p-3 rounded text-xs mb-4" />
                        <button onClick={runNLP} className="w-full bg-emerald-600 p-3 rounded font-bold text-xs uppercase">Run Analysis</button>
                        {history.length > 0 && <button onClick={() => onBridge({ history, names: actors.split(',') })} className="w-full mt-4 bg-blue-600 p-3 rounded font-bold text-xs uppercase">Bridge to Markov</button>}
                    </div>
                    <div className="lg:col-span-2 bg-slate-900 p-6 rounded-xl border border-slate-800 overflow-y-auto max-h-[500px] custom-scroll">
                        {history.map(item => (
                            <div key={item.id} className="axiom-card p-2 mb-2 rounded flex justify-between text-[10px]">
                                <span className="text-blue-400 font-bold">{item.timestamp}</span>
                                <span className="font-bold">{item.actor}</span>
                                <span>P:{item.scores.Psychological} | I:{item.scores.Ideational} | S:{item.scores.Structural}</span>
                                <span className="text-red-400">Injuries: {item.casualties}</span>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        function SimulationTab({ inputData }) {
            const [results, setResults] = useState(null);

            const runSimulation = () => {
                const names = inputData.names.map(n => n.trim());
                const latestA = inputData.history.find(h => h.actor === names[0]);
                const latestB = inputData.history.find(h => h.actor === names[1]);
                
                const iterations = 3000;
                const simResults = { A: [], B: [], InjuryCI: [] };

                const buildMomentumMatrix = (scores) => {
                    let matrix = [[0.7, 0.2, 0.1], [0.3, 0.4, 0.3], [0.1, 0.3, 0.6]];
                    // Sentiment Momentum logic: Psychological scores create "slip" toward escalation
                    if (scores.Psychological > 3) { matrix[0][2] += 0.2; matrix[0][0] -= 0.2; }
                    if (scores.Ideational > 3) { matrix[1][2] += 0.2; matrix[1][1] -= 0.2; }
                    return matrix.map(r => { const s = r.reduce((a,b)=>a+b); return r.map(v => v/s); });
                };

                const matrixA = buildMomentumMatrix(latestA.scores);
                const matrixB = buildMomentumMatrix(latestB.scores);

                for (let i = 0; i < iterations; i++) {
                    let sA = latestA.casualties > 8 ? 2 : 0;
                    let sB = latestB.casualties > 8 ? 2 : 0;

                    for (let t = 0; t < 5; t++) {
                        sA = transition(sA, matrixA);
                        sB = transition(sB, matrixB);
                    }
                    const pA = (sA + 1) / 3 * Math.random();
                    const pB = (sB + 1) / 3 * Math.random();
                    simResults.A.push(pA);
                    simResults.B.push(pB);
                    simResults.InjuryCI.push(Math.round(Math.max(pA, pB) * 120));
                }
                setResults(simResults);
                plot(simResults, names);
            };

            const transition = (s, m) => {
                const r = Math.random();
                let c = 0;
                for (let i=0; i<3; i++) { c += m[s][i]; if (r < c) return i; }
                return s;
            };

            const plot = (data, names) => {
                const traces = [
                    { x: data.A, type: 'histogram', name: names[0], marker: {color: '#3b82f6', opacity: 0.6} },
                    { x: data.B, type: 'histogram', name: names[1], marker: {color: '#ef4444', opacity: 0.6} }
                ];
                Plotly.newPlot('chart', traces, { 
                    barmode: 'overlay', paper_bgcolor: 'transparent', plot_bgcolor: 'transparent',
                    font: { color: '#94a3b8', size: 10 },
                    xaxis: { title: 'Escalation Probability' }
                });
            };

            useEffect(() => { if (inputData) runSimulation(); }, [inputData]);

            if (!inputData) return <div className="text-center p-20 text-slate-500">Wait for data...</div>;

            return (
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div className="bg-slate-900 p-6 rounded-xl border border-slate-800">
                        <h2 className="text-emerald-400 font-bold text-xs uppercase mb-4">Momentum Prediction</h2>
                        {results && (
                            <div className="space-y-4">
                                <div className="p-4 bg-slate-800 rounded border border-blue-500/30">
                                    <p className="text-[10px] text-blue-300 font-bold uppercase">Predicted Injury Range (Next Step)</p>
                                    <p className="text-3xl font-bold">
                                        {Math.min(...results.InjuryCI)} - {Math.max(...results.InjuryCI)}
                                    </p>
                                </div>
                                <div className="text-[9px] text-slate-500 leading-relaxed italic">
                                    *Analysis uses Monte Carlo Markov Chain simulation adjusted for Sentiment Momentum detected in current intelligence corpus.
                                </div>
                            </div>
                        )}
                    </div>
                    <div className="lg:col-span-2 bg-slate-900 p-6 rounded-xl border border-slate-800">
                        <div id="chart" className="w-full h-[400px]"></div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(h(App));
    </script>
</body>
</html>
